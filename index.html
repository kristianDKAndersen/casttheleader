<!DOCTYPE html>
<html>
<head>
    <title>Chromecast Sender</title>
    <script type="text/javascript" src="https://www.gstatic.com/cv/js/sender/v1/cast_sender.js?loadCastFramework=1"></script>
</head>
<body>
    <h1>Chromecast Sender</h1>
    <button id="castButton">Connect to Chromecast</button>
    <button id="sendButton" disabled>Send "Hello"</button>

    <script>
        const applicationId = 'ED052386';
        let castSession = null;

        window.__onGCastApiAvailable = function(isAvailable) {
            if (isAvailable) {
                initializeCastApi();
            }
        };

        function initializeCastApi() {
            const context = cast.framework.CastContext.getInstance();
            context.setOptions({
                receiverApplicationId: applicationId,
                autoJoinPolicy: chrome.cast.AutoJoinPolicy.ORIGIN_SCOPED
            });

            const castButton = document.getElementById('castButton');
            castButton.addEventListener('click', async () => {
                try {
                    castSession = await context.requestSession();
                    document.getElementById('sendButton').disabled = false;
                } catch (error) {
                    console.error('Error:', error);
                }
            });

            document.getElementById('sendButton').addEventListener('click', sendMessage);
        }

        function sendMessage() {
            if (castSession) {
                const message = 'hello';
                const namespace = 'urn:x-cast:com.example.message';
                
                // Get the cast message channel
                const channel = castSession.loadMedia 
                    ? castSession
                    : castSession.getSessionObj();

                channel.sendMessage(namespace, message)
                    .then(() => {
                        console.log('Message sent successfully');
                    })
                    .catch((error) => {
                        console.error('Error sending message:', error);
                    });
            } else {
                console.error('No active session');
            }
        }
    </script>
</body>
</html>